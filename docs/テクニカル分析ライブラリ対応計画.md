# テクニカル分析ライブラリ対応計画

## 背景

TypeScript版の株価サーバーでは、現在テクニカル指標の計算を自前で実装していますが、品質と精度を向上させるために外部ライブラリの使用が望ましいと判断しました。

## 実施内容

1. `technicalindicators` ライブラリのインストール
    ```bash
    npm install technicalindicators
    ```

2. 導入時に発生した問題点
    - ライブラリの型定義に問題があり、特にMACDなどの指標でTypeScriptの型エラーが発生
    - バンドル時にESモジュールとCommonJSの相互運用性の問題が発生

3. 解決策と実装計画
    - 短期対応: 既存の自前実装を当面維持
    - 中期対応: 各テクニカル指標ごとに段階的にライブラリへ移行
      - SMAとEMAから対応（比較的シンプルな型定義）
      - RSI、ボリンジャーバンドへの移行
      - 最後にMACDなど複雑な型を持つ指標へ移行
    - 長期対応: 型定義ファイルの独自拡張またはPRによるライブラリへの貢献

## 移行メリット

1. 精度の向上
   - 金融業界で広く使われているアルゴリズムの実装を利用
   - バグやエッジケースへの対応が充実

2. パフォーマンスの改善
   - 最適化されたアルゴリズムによる計算の高速化
   - メモリ使用量の削減

3. 保守性の向上
   - 複雑なロジックの外部委譲による可読性の改善
   - コードベースの縮小

## 対応スケジュール

| 対応項目                     | 予定日       | ステータス |
|-----------------------------|------------|---------|
| ライブラリのインストールと調査     | 完了済み     | ✅ 完了   |
| 型定義問題の分析               | 完了済み     | ✅ 完了   |
| SMA/EMA実装の移行             | 3日以内     | 🔄 進行中 |
| ボリンジャーバンド/ATR実装の移行   | 1週間以内    | 📅 予定   |
| RSI/ストキャスティクス実装の移行   | 2週間以内    | 📅 予定   |
| MACD実装の移行                | 3週間以内    | 📅 予定   |
| 全体的な統合テスト              | 1ヶ月以内    | 📅 予定   |

## 追加検討事項

1. 代替ライブラリの検討
   - `trading-signals`: TypeScriptネイティブで型サポートが強力
   - `ta-lib`: 高性能だがネイティブバインディングが必要

2. 部分的な自前実装の維持
   - 特に問題のある指標のみ自前実装を維持する折衷案
   - 型付きラッパーの作成 